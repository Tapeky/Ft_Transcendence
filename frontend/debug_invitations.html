<!DOCTYPE html>
<html>
<head>
    <title>Debug Invitations System</title>
    <script>
        // Debug script to check invitation system
        function debugInvitationSystem() {
            console.log('=== INVITATION SYSTEM DEBUG ===');

            // 1. Check if gameInviteService exists
            console.log('1. Checking gameInviteService...');
            if (window.gameInviteService) {
                console.log('✅ gameInviteService exists');
                console.log('   - Connected:', window.gameInviteService.isConnected());
            } else {
                console.log('❌ gameInviteService NOT found');
            }

            // 2. Check if kissInviteButtons exists
            console.log('2. Checking kissInviteButtons...');
            if (window.kissInviteButtons) {
                console.log('✅ kissInviteButtons exists');
                const stats = window.kissInviteButtons.getStats();
                console.log('   - Stats:', stats);
            } else {
                console.log('❌ kissInviteButtons NOT found');
            }

            // 3. Check for invitation buttons in DOM
            console.log('3. Checking DOM for invitation buttons...');
            const buttons = document.querySelectorAll('[data-invite-user]');
            console.log(`   - Found ${buttons.length} buttons with data-invite-user`);

            const setupButtons = document.querySelectorAll('[data-kiss-setup="true"]');
            console.log(`   - Found ${setupButtons.length} KISS-setup buttons`);

            // 4. Check WebSocket connections
            console.log('4. Checking WebSocket state...');
            if (window.gameInviteService && window.gameInviteService.ws) {
                console.log('   - WebSocket state:', window.gameInviteService.ws.readyState);
                console.log('   - Is authenticated:', window.gameInviteService.isAuthenticated);
            }

            // 5. Check auth token
            console.log('5. Checking auth token...');
            const token = localStorage.getItem('authToken') || localStorage.getItem('auth_token');
            console.log('   - Auth token exists:', !!token);
            if (token) {
                console.log('   - Token length:', token.length);
            }

            console.log('=== END DEBUG ===');
        }

        // Function to manually test invitation
        function testInvitation(userId) {
            console.log(`Testing invitation to user ${userId}...`);

            if (window.gameInviteService) {
                try {
                    window.gameInviteService.sendInvite(userId);
                    console.log('✅ Invitation sent successfully');
                } catch (error) {
                    console.error('❌ Error sending invitation:', error);
                }
            } else {
                console.error('❌ gameInviteService not available');
            }
        }

        // Run debug on page load
        window.addEventListener('load', () => {
            setTimeout(debugInvitationSystem, 2000);
        });
    </script>
</head>
<body>
    <h1>Invitation System Debug</h1>
    <button onclick="debugInvitationSystem()">Run Debug</button>
    <button onclick="testInvitation(123)">Test Invitation (User 123)</button>

    <h2>Create Test Button</h2>
    <button data-invite-user="456" data-invite-username="testuser">Test Invite Button</button>

    <div id="debug-output"></div>
</body>
</html>